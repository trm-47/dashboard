<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>DASHBOARD KTA - TRM47</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; text-align: center; padding-top: 50px; }
        .card { border: 10px solid #cc0000; display: inline-block; padding: 40px; border-radius: 30px; background: #111; box-shadow: 0 0 30px #ff0000; }
        .foto { width: 280px; height: 280px; border: 5px solid #fff; margin: 0 auto 20px; background: #222; }
        img { width: 100%; height: 100%; object-fit: cover; }
        h1 { color: #ff0000; font-size: 3em; margin: 10px 0; text-transform: uppercase; }
        .jabatan { color: gold; font-size: 1.8em; }
        .kta { color: #888; font-size: 1.2em; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="card">
        <div class="foto">
            <img id="tampilFoto" src="" onerror="this.src='https://via.placeholder.com/280?text=FOTO'">
        </div>
        <h1 id="tampilNama">MENUNGGU...</h1>
        <div id="tampilJabatan" class="jabatan">-</div>
        <div id="tampilKTA" class="kta">KTA: -</div>
    </div>

    <script>
        // URL CSV (Tanpa API KEY lebih aman)
        const ssID = '1Egbat36S6ZXP-x_bJNHVIQgJi26H-siDsY538_iGl_8';
        const url = `https://docs.google.com/spreadsheets/d/${ssID}/gviz/tq?tqx=out:csv&sheet=Data_Anggota`;

        async function tarikData() {
            try {
                const res = await fetch(url);
                const teks = await res.text();
                
                // Pecah data CSV ke Baris
                const baris = teks.split('\n').map(r => r.split('","').map(c => c.replace(/"/g, '')));
                
                // Filter baris yang ada namanya (Kolom Index 1)
                const dataValid = baris.filter(b => b[1] && b[1].toUpperCase() !== "NAMA" && b[1].toUpperCase() !== "FALSE");

                if (dataValid.length > 0) {
                    const d = dataValid[dataValid.length - 1]; // Ambil orang paling bawah

                    document.getElementById('tampilNama').innerText = d[1];
                    document.getElementById('tampilJabatan').innerText = d[3] || "-";
                    document.getElementById('tampilKTA').innerText = "KTA: " + (d[0] || "-");
                    
                    if(d[2] && d[2] !== "FALSE") {
                        document.getElementById('tampilFoto').src = "foto/" + d[2];
                    }
                }
            } catch (e) {
                document.getElementById('tampilNama').innerText = "KONEKSI GAGAL";
            }
        }

        setInterval(tarikData, 3000);
        tarikData();
    </script>
</body>
</html>
