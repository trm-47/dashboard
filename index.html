<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Dashboard KTA - TRM47</title>
    <style>
        body { background: #000; color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; padding: 20px; }
        .card { border: 8px solid #cc0000; background: #111; display: inline-block; padding: 40px; border-radius: 30px; box-shadow: 0 0 30px #ff0000; max-width: 500px; }
        .photo-frame { width: 300px; height: 300px; border: 5px solid #fff; border-radius: 20px; margin: 0 auto 20px; overflow: hidden; background: #222; }
        img { width: 100%; height: 100%; object-fit: cover; }
        h1 { font-size: 2.5em; margin: 10px 0; color: #ff0000; text-transform: uppercase; }
        .jabatan { font-size: 1.5em; color: #ffd700; margin-bottom: 10px; }
        .kta { font-size: 1.2em; color: #aaa; border-top: 1px solid #333; padding-top: 10px; }
    </style>
</head>
<body>

    <div class="card">
        <div class="photo-frame">
            <img id="displayFoto" src="" onerror="this.src='https://via.placeholder.com/300?text=Foto+Tidak+Ditemukan'">
        </div>
        <h1 id="displayNama">Memuat Data...</h1>
        <div class="jabatan" id="displayJabatan">-</div>
        <div class="kta" id="displayKTA">KTA: -</div>
    </div>

    <script>
        const API_KEY = 'AIzaSyCAhx4FPEkFPSB1a-3gdeBZKvWOKCGuzHE';
        const SHEET_ID = '1Egbat36S6ZXP-x_bJNHVIQgJi26H-siDsY538_iGl_8';
        const RANGE = 'Data_Anggota!A2:I100'; // Baca sampai kolom I (foto)

        async function loadData() {
            try {
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`);
                const data = await response.json();

                if (data.values && data.values.length > 0) {
                    // AMBIL BARIS TERAKHIR (Data orang yang paling baru input)
                    const row = data.values[data.values.length - 1];

                    const kta = row[0];      // Kolom A
                    const nama = row[1];     // Kolom B
                    const fotoRef = row[2];  // Kolom C (Nama file foto)
                    const jabatan = row[3];  // Kolom D

                    document.getElementById('displayNama').innerText = nama || "Tanpa Nama";
                    document.getElementById('displayJabatan').innerText = jabatan || "-";
                    document.getElementById('displayKTA').innerText = "KTA: " + (kta || "-");

                    // LOGIKA FOTO GITHUB:
                    // Jika di Kolom C isinya "budi.jpg", dia cari ke folder foto/budi.jpg
                    if(fotoRef && !fotoRef.includes('http')) {
                        document.getElementById('displayFoto').src = "foto/" + fotoRef;
                    } else if (fotoRef.includes('http')) {
                        document.getElementById('displayFoto').src = fotoRef;
                    }
                } else {
                    document.getElementById('displayNama').innerText = "Data Kosong di Sheet!";
                }
            } catch (err) {
                document.getElementById('displayNama').innerText = "Gagal Konek!";
                console.error(err);
            }
        }

        // Jalankan otomatis
        async function loadData() {
        try {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}&t=${new Date().getTime()}`;
            const response = await fetch(url);
            const data = await response.json();

            if (data.values && data.values.length > 0) {
                // FILTER: Hanya ambil baris yang kolom B (Nama) ada isinya
                const barisValid = data.values.filter(row => row[1] && row[1].trim() !== "");
                
                if (barisValid.length > 0) {
                    // Ambil baris paling bawah yang beneran ada datanya
                    const row = barisValid[barisValid.length - 1];

                    const kta = row[0];      // Kolom A
                    const nama = row[1];     // Kolom B
                    const fotoRef = row[2];  // Kolom C
                    const jabatan = row[3];  // Kolom D

                    document.getElementById('displayNama').innerText = nama;
                    document.getElementById('displayJabatan').innerText = jabatan || "-";
                    document.getElementById('displayKTA').innerText = "KTA: " + (kta || "-");

                    // LOGIKA FOTO:
                    if(fotoRef) {
                        document.getElementById('displayFoto').src = "foto/" + fotoRef;
                    }
                } else {
                    document.getElementById('displayNama').innerText = "Belum Ada Data Terisi";
                }
            }
        } catch (err) {
            console.error(err);
        }
    }
    </script>
</body>
</html>
