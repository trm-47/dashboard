<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
  
  <style>
    /* --- CSS MILIK BOS (SUDAH DIOPTIMALKAN) --- */
    * { box-sizing: border-box; }
    :root { --pdi-red: #FF0000; --pdi-black: #000000; --pdi-white: #FFFFFF; --pdi-silver: #CCCCCC; }
    
    body {
      height: 100vh; margin: 0; padding: 20px 50px 80px 50px;
      display: flex; flex-direction: column; overflow: hidden;
      background: radial-gradient(circle, #200000 0%, #000000 100%);
      font-family: 'Rajdhani', sans-serif; color: var(--pdi-white);
    }

    .header-container {
      display: flex; justify-content: space-between; align-items: center;
      padding: 15px 40px; margin-bottom: 15px;
      background: linear-gradient(180deg, rgba(50, 0, 0, 0.9) 0%, rgba(0, 0, 0, 1) 100%);
      border: 3px solid var(--pdi-red); border-radius: 15px; position: relative; overflow: hidden;
    }

    .main-title { font-family: 'Orbitron'; font-size: 42px; font-weight: 900; text-shadow: 3px 3px 15px var(--pdi-red); letter-spacing: 3px; }

    .info-row { display: flex; gap: 15px; margin-bottom: 15px; }
    .stat-card { flex: 1; padding: 15px; border-radius: 12px; text-align: center; background: linear-gradient(145deg, #111, #000); border: 2px solid rgba(255, 255, 255, 0.1); transition: 0.3s; }
    .stat-value { font-family: 'Orbitron'; font-size: 48px; font-weight: 900; text-shadow: 0 0 10px var(--pdi-red); }
    .stat-label { color: var(--pdi-silver); font-weight: 700; font-size: 14px; text-transform: uppercase; }

    .table-container {
      flex: 1; overflow-y: hidden; border-radius: 15px;
      border: 1px solid rgba(255, 0, 0, 0.3); background: rgba(0, 0, 0, 0.5);
      position: relative; box-shadow: 0 0 20px rgba(255, 0, 0, 0.2);
    }

    table { width: 100%; border-collapse: separate; border-spacing: 0; }
    thead th {
      position: sticky; top: 0; z-index: 10; background: #000;
      padding: 20px; border-bottom: 5px solid var(--pdi-red);
      font-family: 'Orbitron'; font-size: 18px; text-align: left;
    }

    td { padding: 15px 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); font-size: 24px; font-weight: 700; }
    
    .status-badge {
      display: inline-block; padding: 5px 15px; border-radius: 5px;
      font-family: 'Orbitron'; font-size: 14px; font-weight: 900; border: 1px solid #fff;
    }

    .system-footer {
      position: fixed; bottom: 0; left: 0; width: 100%; height: 50px;
      display: flex; align-items: center; z-index: 9999;
      background: linear-gradient(to top, rgba(229, 26, 21, 0.4) 0%, transparent 100%);
    }

    .footer-label { background: #e51a15; color: white; padding: 0 30px; height: 100%; display: flex; align-items: center; font-family: 'Orbitron'; font-weight: 900; clip-path: polygon(0 0, 85% 0, 100% 100%, 0% 100%); }

    /* Animasi Baris Baru */
    .row-baru { animation: rowGlow 2s infinite ease-in-out; border-left: 10px solid #ff0000 !important; }
    @keyframes rowGlow { 0%, 100% { background: rgba(255, 0, 0, 0.1); } 50% { background: rgba(255, 0, 0, 0.3); } }
  </style>
</head>

<body>

  <div class="header-container">
    <div>
      <div class="main-title">MONITORING SYSTEM</div>
      <div class="sub-title">REAL-TIME ATTENDANCE DATA CENTER</div>
    </div>
    <div class="time-big" id="jamDigital">00:00:00</div>
  </div>

  <div class="info-row">
    <div class="stat-card">
      <div class="stat-value" id="countHadir">0</div>
      <div class="stat-label">Total Hadir</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="countIzin">0</div>
      <div class="stat-label">Izin/Sakit</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="countPersen">0%</div>
      <div class="stat-label">Persentase</div>
    </div>
  </div>

  <div class="table-container" id="scrollContainer">
    <table>
      <thead>
        <tr>
          <th style="width: 10%; text-align: center;">NO</th>
          <th style="width: 50%;">NAMA PENGURUS</th>
          <th style="width: 20%;">WAKTU</th>
          <th style="width: 20%; text-align: center;">STATUS</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        </tbody>
    </table>
  </div>

  <footer class="system-footer">
    <div class="footer-label">SYSTEM INFO</div>
    <marquee id="marqueeFooter">Menunggu Sinkronisasi Data Dari Server...</marquee>
  </footer>

  <script>
    let barisTerakhir = 0;

    // 1. Fungsi Jam
    function updateJam() {
      const now = new Date();
      document.getElementById('jamDigital').innerText = now.toLocaleTimeString('id-ID');
    }
    setInterval(updateJam, 1000);

    // 2. Ambil Data Dari Spreadsheet
    function muatData() {
      google.script.run.withSuccessHandler(tampilkanData).getDataDashboard();
    }

    function tampilkanData(data) {
      // Update KPI
      document.getElementById('countHadir').innerText = data.hadir;
      document.getElementById('countIzin').innerText = data.izin;
      document.getElementById('countPersen').innerText = (data.persen * 100).toFixed(1) + "%";

      // Update Tabel
      const tbody = document.getElementById('tableBody');
      let html = "";
      
      data.daftar.forEach((row, index) => {
        let statusStyle = row[3] === "HADIR" ? "color: #FF0000; border-color: #FF0000;" : "color: #FFF; border-color: #FFF;";
        let rowClass = (index + 1 > barisTerakhir && barisTerakhir !== 0) ? "row-baru" : "";
        
        html += `<tr class="${rowClass}">
          <td style="text-align: center;">${row[0]}</td>
          <td>${row[1]}</td>
          <td>${row[2]}</td>
          <td style="text-align: center;"><span class="status-badge" style="${statusStyle}">${row[3]}</span></td>
        </tr>`;
      });
      
      tbody.innerHTML = html;
      
      // Update Marquee Footer
      if(data.daftar.length > 0) {
        document.getElementById('marqueeFooter').innerText = `Update Terakhir: ${new Date().toLocaleTimeString()} | Total Pengurus Terdata: ${data.daftar.length} Orang.`;
      }
      
      barisTerakhir = data.daftar.length;
    }

    // 3. Auto Scroll (Cocok buat Videotron)
    function autoScroll() {
      const container = document.getElementById('scrollContainer');
      if (container.scrollHeight > container.clientHeight) {
        if (container.scrollTop + container.clientHeight >= container.scrollHeight) {
          setTimeout(() => { container.scrollTop = 0; }, 2000);
        } else {
          container.scrollTop += 1;
        }
      }
    }

    // Jalankan Interval
    setInterval(muatData, 5000); // Cek data tiap 5 detik
    setInterval(autoScroll, 50); // Jalankan scroll halus
    muatData(); // Jalankan sekali saat start
  </script>
</body>
</html>
