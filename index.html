<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard KTA</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; text-align: center; padding-top: 50px; }
        .card { border: 5px solid #ff0000; display: inline-block; padding: 30px; border-radius: 20px; background: #111; box-shadow: 0 0 20px red; }
        .photo { width: 250px; height: 250px; border: 3px solid #fff; margin: 0 auto 20px; background: #222; overflow: hidden; }
        img { width: 100%; height: 100%; object-fit: cover; }
        h1 { color: #ff0000; margin: 10px 0; }
        .jabatan { color: gold; font-size: 1.2em; }
    </style>
</head>
<body>

    <div class="card">
        <div class="photo">
            <img id="imgF" src="" onerror="this.src='https://via.placeholder.com/250?text=FOTO'">
        </div>
        <h1 id="txtNama">MEMUAT...</h1>
        <div id="txtJabatan" class="jabatan">-</div>
        <div id="txtKTA" style="margin-top:10px; color:#888;">KTA: -</div>
        <div id="txtStatus" style="font-size:10px; color:#333; margin-top:20px;"></div>
    </div>

    <script>
        // DATA UTAMA
        const KEY = 'AIzaSyCAhx4FPEkFPSB1a-3gdeBZKvWOKCGuzHE';
        const SID = '1Egbat36S6ZXP-x_bJNHVIQgJi26H-siDsY538_iGl_8';
        const TAB = 'Data_Anggota!A2:E100';

        async function ambilData() {
            const status = document.getElementById('txtStatus');
            try {
                status.innerText = "Mengecek koneksi...";
                const r = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SID}/values/${TAB}?key=${KEY}`);
                const d = await r.json();

                if (d.values && d.values.length > 0) {
                    // Filter baris yang kolom B (Nama) tidak kosong dan bukan FALSE
                    const list = d.values.filter(b => b[1] && b[1].toString().toUpperCase() !== "FALSE");
                    
                    if (list.length > 0) {
                        const baris = list[list.length - 1]; // Ambil yang paling bawah
                        
                        document.getElementById('txtNama').innerText = baris[1];
                        document.getElementById('txtJabatan').innerText = (baris[3] && baris[3] !== "FALSE") ? baris[3] : "-";
                        document.getElementById('txtKTA').innerText = "KTA: " + (baris[0] || "-");
                        
                        // Foto
                        if(baris[2] && baris[2] !== "FALSE") {
                            document.getElementById('imgF').src = "foto/" + baris[2];
                        }
                        status.innerText = "Data Terkoneksi!";
                    } else {
                        document.getElementById('txtNama').innerText = "Belum Ada Data";
                    }
                }
            } catch (e) {
                document.getElementById('txtNama').innerText = "ERROR KONEKSI!";
                console.error(e);
            }
        }

        // Jalankan
        ambilData();
        // Refresh tiap 5 detik
        setInterval(ambilData, 5000);
    </script>
</body>
</html>
